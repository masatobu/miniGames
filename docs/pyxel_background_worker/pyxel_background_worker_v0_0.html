<!DOCTYPE html>
<script src="https://cdn.jsdelivr.net/gh/kitao/pyxel@2.5.7/wasm/pyxel.js"></script>
<script>
    const LOCALSTORAGE_KEY = "pyxel_background_worker";

    async function main() {
        let canvas = await _createScreenElements();
        let pyodide = await _loadPyodideAndPyxel(canvas);

        _loadPyodideAndPyxel = async () => pyodide;
        _createScreenElements = async () => null;

        function checkAndSave() {
            try {
                if (pyodide.FS.analyzePath("/save_data.txt").exists) {
                    let data = pyodide.FS.readFile("/save_data.txt", { encoding: "utf8" });
                    localStorage.setItem(LOCALSTORAGE_KEY, data);
                    pyodide.FS.unlink("/save_data.txt");  // 削除して「保存済み」状態に
                    console.log("Saved to localStorage:", data);
                }
            } catch (e) {
                console.warn("checkAndSave error:", e);
            }
        }

        // 1秒おきにチェック
        setInterval(checkAndSave, 1000);

        // 起動時に localStorage のデータを復元
        let saved = localStorage.getItem(LOCALSTORAGE_KEY);
        if (saved) {
            pyodide.FS.writeFile("/load_data.txt", saved);
            console.log("Loaded saved data from localStorage");
        }
        launchPyxel({ command: "play", name: "pyxel_background_worker.pyxapp", gamepad: "enabled", base64: "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" });
    }

    main();
</script>